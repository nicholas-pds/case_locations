{% extends "base.html" %}
{% block title %}Airway Hold Status{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="/static/css/airway.css">{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">Airway Hold Status Report</h1>
</div>

<div class="filter-bar mb-24">
  <button class="btn btn-reset"
          hx-get="/partials/airway-hold-table"
          hx-target="#airway-hold-content"
          hx-swap="innerHTML">
    Reset Filters
  </button>
  <select name="hold_status" class="filter-select"
          hx-get="/partials/airway-hold-table"
          hx-trigger="change"
          hx-target="#airway-hold-content">
    <option value="">All Hold Statuses</option>
    {% for hs in hold_statuses %}
    <option value="{{ hs }}">{{ hs }}</option>
    {% endfor %}
  </select>
</div>

<div class="table-container airway-hold-sticky">
  <div id="airway-hold-content"
       hx-get="/partials/airway-hold-table"
       hx-trigger="sse:data-refreshed"
       hx-include="[name='hold_status']"
       hx-swap="innerHTML">
    {% include "partials/airway_hold_table.html" %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function airwaySort() {
  return {
    col: null,
    dir: 'asc',
    sort(colIdx) {
      if (this.col === colIdx) {
        this.dir = this.dir === 'asc' ? 'desc' : 'asc';
      } else {
        this.col = colIdx;
        this.dir = 'asc';
      }
      const tbody = this.$el.querySelector('tbody');
      if (!tbody) return;
      const rows = Array.from(tbody.querySelectorAll('tr'));
      const dir = this.dir === 'asc' ? 1 : -1;
      rows.sort((a, b) => {
        const aText = (a.cells[colIdx]?.textContent || '').trim();
        const bText = (b.cells[colIdx]?.textContent || '').trim();
        const aNum = parseFloat(aText);
        const bNum = parseFloat(bText);
        if (!isNaN(aNum) && !isNaN(bNum)) return (aNum - bNum) * dir;
        return aText.localeCompare(bText) * dir;
      });
      rows.forEach(r => tbody.appendChild(r));
    },
    indicator(colIdx) {
      if (this.col !== colIdx) return '';
      return this.dir === 'asc' ? '\u25B2' : '\u25BC';
    }
  };
}
</script>
{% endblock %}
