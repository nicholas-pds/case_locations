{% for group_name, stage_list in stages.items() %}
<div class="stage-section">
  <div class="stage-section-title">{{ group_name }}</div>
  <div class="stage-grid">
    {% for stage in stage_list %}
    <div class="stage-card">
      <div class="stage-card-header"
           hx-get="/partials/airway-table?location={{ stage.name | urlencode }}"
           hx-target="#airway-table-content"
           hx-swap="innerHTML">
        <div class="stage-name">{{ stage.name }}</div>
        <div class="stage-count">{{ stage.total }}</div>
      </div>
      {% if stage.by_date %}
      <ul class="stage-dates">
        {% for date_str, info in stage.by_date.items() %}
        <li hx-get="/partials/airway-table?location={{ stage.name | urlencode }}&ship_date={{ info.iso }}"
            hx-target="#airway-table-content"
            hx-swap="innerHTML">
          {{ date_str }} <span class="stage-date-count">({{ info.count }})</span>
        </li>
        {% endfor %}
        {% if stage.extra_dates > 0 %}
        <li class="extra">+{{ stage.extra_dates }} more</li>
        {% endif %}
      </ul>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</div>
{% endfor %}
